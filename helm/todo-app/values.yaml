# Todo App Helm Chart - Parent Values
# This file contains global settings and defaults for subcharts

# Global settings applied to all subcharts
global:
  imagePullPolicy: Never  # Use local images in Minikube
  nodeEnv: production

# Frontend subchart configuration
frontend:
  enabled: true
  replicaCount: 1

  image:
    repository: todo-frontend
    tag: local
    pullPolicy: Never

  service:
    type: NodePort
    port: 80
    targetPort: 3000
    nodePort: 30080

  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

  livenessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 10
    periodSeconds: 10

  readinessProbe:
    httpGet:
      path: /
      port: 3000
    initialDelaySeconds: 5
    periodSeconds: 5

  env:
    NEXT_PUBLIC_API_URL: "http://todo-backend:80"

# Backend subchart configuration
backend:
  enabled: true
  replicaCount: 1

  image:
    repository: todo-backend
    tag: local
    pullPolicy: Never

  service:
    type: NodePort
    port: 80
    targetPort: 8000
    nodePort: 30081

  resources:
    requests:
      cpu: "200m"
      memory: "256Mi"
    limits:
      cpu: "1000m"
      memory: "1Gi"

  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 15
    periodSeconds: 10

  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 10
    periodSeconds: 5

  # Non-sensitive configuration (ConfigMap)
  config:
    PYTHONUNBUFFERED: "1"
    LOG_LEVEL: "INFO"

  # Sensitive configuration (Secret)
  # These values should be overridden in values-secrets.yaml or via --set
  secrets:
    DATABASE_URL: ""
    GEMINI_API_KEY: ""
    SECRET_KEY: ""

# Phase V: Event-Driven Architecture Configuration

# Dapr settings
dapr:
  enabled: true
  pubsub:
    brokers: "redpanda:9092"
  statestore:
    secretName: "db-credentials"
    secretKey: "connection-string"

# Notification service (Dapr consumer)
notification:
  enabled: true
  replicaCount: 1
  image:
    repository: todo-app/notification-service
    tag: latest
    pullPolicy: IfNotPresent
  dapr:
    enabled: true
    appId: notification-service
    appPort: 5001
  env:
    DAPR_HTTP_PORT: "3500"
    PUBSUB_NAME: "taskpubsub"
    BACKEND_URL: "http://todo-backend:80"

# Recurring task service (Dapr consumer)
recurringTask:
  enabled: true
  replicaCount: 1
  image:
    repository: todo-app/recurring-task-service
    tag: latest
    pullPolicy: IfNotPresent
  dapr:
    enabled: true
    appId: recurring-task-service
    appPort: 5002
  env:
    DAPR_HTTP_PORT: "3500"
    PUBSUB_NAME: "taskpubsub"
    BACKEND_URL: "http://todo-backend:80"

# Audit service (Dapr consumer)
audit:
  enabled: true
  replicaCount: 1
  image:
    repository: todo-app/audit-service
    tag: latest
    pullPolicy: IfNotPresent
  dapr:
    enabled: true
    appId: audit-service
    appPort: 5003
  env:
    DAPR_HTTP_PORT: "3500"
    PUBSUB_NAME: "taskpubsub"

# Redpanda (Kafka-compatible message broker)
redpanda:
  enabled: true
  statefulset:
    replicas: 1
  storage:
    persistentVolume:
      enabled: false
  resources:
    cpu:
      cores: 1
    memory:
      container:
        max: 2Gi
  external:
    enabled: false
  auth:
    sasl:
      enabled: false
  tls:
    enabled: false
  listeners:
    kafka:
      port: 9092
